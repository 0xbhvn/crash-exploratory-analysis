# Alembic Database Migration Guide

This directory contains the database migration scripts for the Crash Game Streak Prediction API.

## ⚠️ IMPORTANT: NEVER MANUALLY EDIT MIGRATION FILES ⚠️

**All Alembic migration files should be generated ONLY through the command line interface.**

Manually editing migration files can lead to:

- Inconsistent database states
- Failed migrations
- Data corruption
- Version control conflicts

Always use the Alembic command line tools to generate and manage migrations.

## Alembic Command Line Usage

Alembic is a database migration tool that allows you to make changes to your database schema in a way that can be versioned, applied, and rolled back.

### Common Alembic Commands

Always run these commands from the `/api` directory to ensure proper context.

#### Initialize Alembic (Already Done)

```bash
# Create the migrations directory and configuration files
alembic init migrations
```

#### Create a New Migration

```bash
# Generate a migration automatically by comparing the database to your models
alembic revision --autogenerate -m "Description of your changes"
```

#### Apply Migrations

```bash
# Apply all pending migrations
alembic upgrade head

# Apply a specific number of migrations
alembic upgrade +1

# Apply migrations up to a specific revision
alembic upgrade revision_id
```

#### Rollback Migrations

```bash
# Rollback the most recent migration
alembic downgrade -1

# Rollback all migrations
alembic downgrade base

# Rollback to a specific revision
alembic downgrade revision_id
```

#### View Migration History

```bash
# Show all migration versions
alembic history

# Show current revision
alembic current
```

### Example Workflow

1. Make changes to your SQLAlchemy models in the `app/models` directory
2. Generate a migration:

   ```bash
   alembic revision --autogenerate -m "Add user table"
   ```

3. Review the generated migration in `migrations/versions/`
4. Apply the migration:

   ```bash
   alembic upgrade head
   ```

### Best Practices

1. Always review autogenerated migrations before applying them
2. Test migrations in a development environment before production
3. Never modify a migration that has been applied to production
4. Keep migrations small and focused on specific changes
5. **Never manually edit migration files** - generate new ones instead

### Troubleshooting

If you encounter issues with migrations:

1. Check that your models are properly defined and imported in `migrations/env.py`
2. Verify your database connection in the `.env` file
3. Look for detailed errors in the Alembic output

### Security Note

Database credentials should never be stored in the alembic.ini file. Always use environment variables through the `env.py` file to configure your database connection.
